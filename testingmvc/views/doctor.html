<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

</head>
<body>
    <h1>Doctors</h1>
    <div class="mb-3 category-list">
    <label for="categorySelect" class="form-label">Filter by Category</label>
    <select name="categorySelect form-select" id="category-list" ></select>
    </div>
    <form action="/doctors" method="post">
        <input id="doctorInput" type="text" placeholder="masukkan nama dokter" >
    </form>

    <div id="doctor-list"></div>

    

    
</body>
<script>
    const categories = <!--CATEGORY_DATA-->;
    const doctors = <!--DOCTOR_DATA-->;

    const input = document.getElementById("doctorInput");
    const list = document.getElementById("doctor-list");
    const select = document.getElementById("category-list");
    select.innerHTML += `<option value="default" selected>Option</option>`
    categories.forEach(elm=>{
        
        select.innerHTML += 
        `<option value=${elm.name}>${elm.name}</option>`;
        
    });

    

    
    function showDoctor(data) {
        list.innerHTML = "";
        data.forEach(elm => {
                const card = document.createElement("div");
                
                card.innerHTML = `
                
                    <div class="card p-2 mb-2">
                        <h4>${elm.name}</h4>
                        <p>Email: ${elm.email}</p>
                        <p>Gender: ${elm.gender}</p>
                        <p>category: ${elm.Category.name}</p>
                        <form method="POST" action="/appointment">
                            <input type="hidden" name="id_doctor" value="${elm.id_doctor}"/>
                            <button type="submit" class="btn btn-primary">Booking</button>
                        </form>
                    </div>
                `;
                list.appendChild(card);
        });

    }

    showDoctor(doctors);

    input.addEventListener("input", () => {
        const name = input.value.toLowerCase();
        const filtered = doctors.filter(d => d.name.toLowerCase().includes(name));
        showDoctor(filtered);
    });
    
    select.addEventListener("click", () =>{
        let options = select.querySelectorAll("option");
        let count = options.length;
        if(typeof(count) === "undefined" || count < 2){
            console.log("opsinya tidak ada");
        }
    });
    select.addEventListener("change", function() {

        if(select.value == "default")
        {
            showDoctor(doctors);
        }
        else{
            let value = select.options[select.selectedIndex].value.toLowerCase();
            console.log(value);
            const filtered = doctors.filter(d => d.Category.name.toLowerCase().includes(value));
            console.log(filtered);
            showDoctor(filtered);
        }
    });
    



   

    
</script>
</html>